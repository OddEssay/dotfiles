---
- hosts: localhost
  sudo: no
  vars: 
    install_state: present # Override with: --extra-vars "install_state=latest"
  tasks:
    - stat: path=/usr/local
      register: usrlocal
    - name: If root owns /usr/local, change it to current user.
      shell: sudo chown -R $(whoami):admin /usr/local
      when: usrlocal.stat.pw_name == "root"
    - name: Clean up and update
      shell: (brew update || true) && (brew upgrade brew-cask || true) && (brew cleanup || true) && (brew cask cleanup || true) && (brew prune || true)
      ignore_errors: yes
    - name: Homebrew tap
      homebrew_tap: name={{ item }} state=present
      with_items:
        - ethereum/ethereum
    - name: Install homebrew items
      homebrew: name={{ item }} state={{ install_state }}
      with_items:
        - the_silver_searcher
        - ctags-exuberant
        - tmux
        - tidy-html5
        - vim
        - exercism
        - tree
        - ethereum
        - gs
        - postgresql
        - openssl
        - imagemagick
        - gpg
        - reattach-to-user-namespace
        - diff-so-fancy
        - sslmate
        - node
        - nvm
        - heroku-toolbelt

    - name: Fix OpenSSL link issue
      shell: brew link --force openssl

    - name: Install homebrew_cask items
      homebrew_cask: name={{ item }} state=present
      with_items:
        - ngrok
        - virtualbox
        - vagrant
        - google-chrome
        - transmit
        - caffeine
        - rescuetime
        - dropbox
        - moom
        - jeromelebel-mongohub
        - sqlitebrowser
        - calibre
        - xquartz
        - wireshark
        - atom

    - name: Install Global NPM items
      npm: name={{ item }} global=true state={{ install_state }}
      with_items:
        - jshint
        - nd
        - eslint
        - eslint-plugin-react
        - eslint-plugin-underscore
        - eslint-plugin-mocha
        - firebase-tools
        - greenkeeper

    - name: Install Gems
      shell: rvm @global do gem install {{ item }}
      with_items:
        - tmuxinator
        - flog
        - excellent
        - lolcommits
